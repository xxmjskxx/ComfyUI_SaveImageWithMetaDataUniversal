{
  "id": "ebdcadb3-4747-47af-9c97-31ad5e56090e",
  "revision": 0,
  "last_node_id": 38,
  "last_link_id": 16,
  "nodes": [
    {
      "id": 27,
      "type": "ShowText|unimeta",
      "pos": [
        1860,
        1330
      ],
      "size": [
        370,
        400
      ],
      "flags": {
        "collapsed": false
      },
      "order": 11,
      "mode": 0,
      "inputs": [
        {
          "name": "text",
          "type": "STRING",
          "link": 9
        }
      ],
      "outputs": [
        {
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "ShowText|unimeta",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": []
    },
    {
      "id": 30,
      "type": "ShowText|unimeta",
      "pos": [
        2590,
        1330
      ],
      "size": [
        300,
        270
      ],
      "flags": {},
      "order": 12,
      "mode": 0,
      "inputs": [
        {
          "name": "text",
          "type": "STRING",
          "link": 10
        }
      ],
      "outputs": [
        {
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "ShowText|unimeta",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "Merged updates into C:\\StableDiffusion\\StabilityMatrix-win-x64\\Data\\Packages\\ComfyUI_windows_portable\\ComfyUI\\custom_nodes\\ComfyUI_SaveImageWithMetaDataUniversal\\saveimage_unimeta\\defs\\ext\\generated_user_rules.py"
      ]
    },
    {
      "id": 31,
      "type": "ShowText|unimeta",
      "pos": [
        2910,
        280
      ],
      "size": [
        300,
        270
      ],
      "flags": {},
      "order": 18,
      "mode": 0,
      "inputs": [
        {
          "name": "text",
          "type": "STRING",
          "link": 11
        }
      ],
      "outputs": [
        {
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "ShowText|unimeta",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "mode=overwrite; backup=20251009-074553; pruned=1; nodes=352; samplers=33"
      ]
    },
    {
      "id": 18,
      "type": "SaveCustomMetadataRules",
      "pos": [
        2570,
        280
      ],
      "size": [
        310,
        420
      ],
      "flags": {},
      "order": 17,
      "mode": 0,
      "inputs": [
        {
          "name": "rules_json_string",
          "type": "STRING",
          "widget": {
            "name": "rules_json_string"
          },
          "link": 16
        }
      ],
      "outputs": [
        {
          "name": "status",
          "type": "STRING",
          "links": [
            11
          ]
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "c9a87453bc4257614c87d28a64a5be9c4fdccba9",
        "Node name for S&R": "SaveCustomMetadataRules",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {
            "rules_json_string": true
          },
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "",
        "overwrite",
        true,
        "none",
        false,
        true,
        20
      ]
    },
    {
      "id": 32,
      "type": "ShowText|unimeta",
      "pos": [
        2890,
        800
      ],
      "size": [
        300,
        270
      ],
      "flags": {},
      "order": 15,
      "mode": 0,
      "inputs": [
        {
          "name": "text",
          "type": "STRING",
          "link": 12
        }
      ],
      "outputs": [
        {
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "ShowText|unimeta",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": []
    },
    {
      "id": 28,
      "type": "ShowGeneratedUserRules",
      "pos": [
        1610,
        1330
      ],
      "size": [
        233.69198608398438,
        26
      ],
      "flags": {},
      "order": 0,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "generated_user_rules.py",
          "type": "STRING",
          "links": [
            9
          ]
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "ShowGeneratedUserRules",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": []
    },
    {
      "id": 29,
      "type": "SaveGeneratedUserRules",
      "pos": [
        2260,
        1320
      ],
      "size": [
        300,
        410
      ],
      "flags": {},
      "order": 1,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "status",
          "type": "STRING",
          "links": [
            10
          ]
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "SaveGeneratedUserRules",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "",
        true
      ]
    },
    {
      "id": 25,
      "type": "Note",
      "pos": [
        1210,
        1320
      ],
      "size": [
        380,
        410
      ],
      "flags": {},
      "order": 2,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "You can view, edit, and add to generated_user_rules.py created by Save Custom Metadata Rules, with the Show generated_user_rules.py node.\n\nUse the 'Save generated_user_rules.py' node to commit your changes to generated_user_rules.py. Enable append to append the file. Disable append to overwrite the file."
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 35,
      "type": "ShowText|unimeta",
      "pos": [
        2240,
        1850
      ],
      "size": [
        169.83065795898438,
        26
      ],
      "flags": {},
      "order": 13,
      "mode": 0,
      "inputs": [
        {
          "name": "text",
          "type": "STRING",
          "link": 13
        }
      ],
      "outputs": [
        {
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "71ea75bb29f23dbc86e8f8ede1c25c253a6b8d9d",
        "Node name for S&R": "ShowText|unimeta",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": []
    },
    {
      "id": 34,
      "type": "MetadataForceInclude",
      "pos": [
        1790,
        1840
      ],
      "size": [
        400,
        200
      ],
      "flags": {},
      "order": 3,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "forced_classes",
          "type": "FORCED_CLASSES",
          "links": null
        },
        {
          "name": "forced_classes_str",
          "type": "STRING",
          "links": [
            13
          ]
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "71ea75bb29f23dbc86e8f8ede1c25c253a6b8d9d",
        "Node name for S&R": "MetadataForceInclude",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "",
        false,
        false
      ]
    },
    {
      "id": 33,
      "type": "Note",
      "pos": [
        1210,
        1830
      ],
      "size": [
        550,
        520
      ],
      "flags": {},
      "order": 4,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "This is a node created by Copilot when it misunderstood my instructions. I kept it in case someone finds it useful. The forced_classes output doesn't connect to anything.\n\nMetadata Force Include keeps specified node class names “always eligible” when loading your saved metadata rules—so their fields don’t silently vanish if the node is temporarily absent, filtered, or missed by heuristics. This is different from the scanner’s optional force_include_node_class input, which only affects rule suggestion generation; this node affects actual save‑time metadata assembly.\n\nUse it to: (1) preserve handcrafted rule blocks for rare loaders/samplers, (2) keep stable parameter string structure / diff consistency, (3) bridge heuristic gaps in fast‑changing custom packs, (4) pre‑anchor future manual rules (empty now, populated later). It doesn’t fabricate data—if the node truly isn’t in the graph, you just keep the slot available.\n\nHow: add the node → list exact class names (newline or comma separated) in force_include_node_class → optionally toggle reset_forced when redefining the set. Keep the list small (only what you rely on); prune stale entries periodically. Scanner for discovery; Force Include for runtime stability."
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 2,
      "type": "MetadataRuleScanner",
      "pos": [
        1600,
        810
      ],
      "size": [
        530,
        234
      ],
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "suggested_rules_json",
          "type": "STRING",
          "links": [
            3
          ]
        },
        {
          "name": "diff_report",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "c9a87453bc4257614c87d28a64a5be9c4fdccba9",
        "Node name for S&R": "MetadataRuleScanner",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "mask,find,resize,rotate,detailer,bus,scale,vision,text to,crop,xy,plot,controlnet,save,trainlora,postshot,loramanager",
        true,
        "all",
        "",
        ""
      ]
    },
    {
      "id": 12,
      "type": "Note",
      "pos": [
        1210,
        800
      ],
      "size": [
        380,
        410
      ],
      "flags": {},
      "order": 6,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "Use Metadata Rule Scanner to scan all currently installed nodes. You can display the rules generated by Metadata Rule Scanner as a string in JSON format in a Show Text node.\n\nIf you see any entries you'd like to remove, you can do so. If you understand the formatting and syntax, you can add custom node entries as well. \n\nOnce you're happy with the list, paste it into the Save Custom Metadata Rules node and run that node. Your rules will be written to */custom_nodes/ComfyUI_SaveImageWithMetaDataUniversal/saveimage_unimeta/defs/ext/generated_user_rules.py and used by Save Image w/ Metadata Universal to create your image metadata the next time you use it to save an image."
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 10,
      "type": "Note",
      "pos": [
        1210,
        280
      ],
      "size": [
        380,
        290
      ],
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "You can plug Metadata Rule Scanner directly into Save Custom Metadata Rules. The rules will be written to */custom_nodes/ComfyUI_SaveImageWithMetaDataUniversal/saveimage_unimeta/defs/ext/generated_user_rules.py and used by Save Image w/ Metadata Universal to create your image metadata the next time you use it to save an image."
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 15,
      "type": "ShowText|unimeta",
      "pos": [
        2140,
        810
      ],
      "size": [
        370,
        400
      ],
      "flags": {
        "collapsed": false
      },
      "order": 14,
      "mode": 0,
      "inputs": [
        {
          "name": "text",
          "type": "STRING",
          "link": 3
        }
      ],
      "outputs": [
        {
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "ShowText|unimeta",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": []
    },
    {
      "id": 3,
      "type": "SaveCustomMetadataRules",
      "pos": [
        2550,
        800
      ],
      "size": [
        310,
        420
      ],
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "status",
          "type": "STRING",
          "links": [
            12
          ]
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "c9a87453bc4257614c87d28a64a5be9c4fdccba9",
        "Node name for S&R": "SaveCustomMetadataRules",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "",
        "overwrite",
        true,
        "none",
        false,
        true,
        20
      ]
    },
    {
      "id": 37,
      "type": "MarkdownNote",
      "pos": [
        720,
        240
      ],
      "size": [
        460,
        710
      ],
      "flags": {},
      "order": 9,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {},
      "widgets_values": [
        "# Getting Started\n\nSelect either **Option 1** (the simple route) or **Option 2** (which allows for manually editing and/or adding metadata capture rules before saving them).\n\n## Option 1\n\n- Execute only the nodes in the 'Option 1 (simplest)' group.\n- Your custom metadata capture rules will be created and saved.\n- You can now begin saving images using the 'Save Image w/ Metadata Universal' node.\n\n## Option 2\n\n- This method is more complicated and will likely require you to read the documentation on the [Github repo](https://github.com/xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal) to understand the syntax.\n- First execute only the nodes in the 'Option 2 Part 1 (recommended)' group.\n- Your custom metadata capture rules will be printed to the 'Show Text (UniMeta)' node in JSON format.\n- Copy the text from the 'Show Text (UniMeta)' node and paste it into the 'Save Custom Metadata Rules' node.\n- Edit/remove/add any rules.\n- Run only the nodes in the 'Option 2 Part 2' group.\n- Your custom metadata capture rules will be created and saved.\n- You can now begin saving images using the 'Save Image w/ Metadata Universal' node."
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 16,
      "type": "MetadataRuleScanner",
      "pos": [
        1620,
        290
      ],
      "size": [
        530,
        234
      ],
      "flags": {},
      "order": 10,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "suggested_rules_json",
          "type": "STRING",
          "links": [
            15
          ]
        },
        {
          "name": "diff_report",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "c9a87453bc4257614c87d28a64a5be9c4fdccba9",
        "Node name for S&R": "MetadataRuleScanner",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      },
      "widgets_values": [
        "mask,find,resize,rotate,detailer,bus,scale,vision,text to,crop,xy,plot,controlnet,save,trainlora,postshot,loramanager",
        true,
        "all",
        "",
        ""
      ]
    },
    {
      "id": 38,
      "type": "ShowText|unimeta",
      "pos": [
        2170,
        290
      ],
      "size": [
        370,
        400
      ],
      "flags": {
        "collapsed": false
      },
      "order": 16,
      "mode": 0,
      "inputs": [
        {
          "name": "text",
          "type": "STRING",
          "link": 15
        }
      ],
      "outputs": [
        {
          "name": "STRING",
          "shape": 6,
          "type": "STRING",
          "links": [
            16
          ]
        }
      ],
      "properties": {
        "cnr_id": "SaveImageWithMetaDataUniversal",
        "ver": "45e2e5ea7b07268ff61806feea080ee3ea80fc1f",
        "Node name for S&R": "ShowText|unimeta",
        "aux_id": "xxmjskxx/ComfyUI_SaveImageWithMetaDataUniversal",
        "ue_properties": {
          "widget_ue_connectable": {},
          "version": "7.1",
          "input_ue_unconnectable": {}
        }
      }
    }
  ],
  "links": [
    [
      3,
      2,
      0,
      15,
      0,
      "STRING"
    ],
    [
      9,
      28,
      0,
      27,
      0,
      "STRING"
    ],
    [
      10,
      29,
      0,
      30,
      0,
      "STRING"
    ],
    [
      11,
      18,
      0,
      31,
      0,
      "STRING"
    ],
    [
      12,
      3,
      0,
      32,
      0,
      "STRING"
    ],
    [
      13,
      34,
      1,
      35,
      0,
      "STRING"
    ],
    [
      15,
      16,
      0,
      38,
      0,
      "STRING"
    ],
    [
      16,
      38,
      0,
      18,
      0,
      "STRING"
    ]
  ],
  "groups": [
    {
      "id": 1,
      "title": "Option 2 Part 1 (recommended)",
      "bounding": [
        1200,
        730,
        1320,
        503.6000061035156
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 2,
      "title": "Option 1 (simplest)",
      "bounding": [
        1200,
        210,
        2020,
        503.6000061035156
      ],
      "color": "#a1309b",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 3,
      "title": "Option 2 Part 2",
      "bounding": [
        2540,
        730,
        660,
        503.6000061035156
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 4,
      "title": "View and edit generated_user_rules.py (optional)",
      "bounding": [
        1200,
        1250,
        1040,
        493.6000061035156
      ],
      "color": "#b58b2a",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 5,
      "title": "Save generated_user_rules",
      "bounding": [
        2250,
        1250,
        650,
        493.6000061035156
      ],
      "color": "#b58b2a",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 6,
      "title": "Metadata Force Include (optional)",
      "bounding": [
        1200,
        1760,
        1219.83056640625,
        603.5999755859375
      ],
      "color": "#8AA",
      "font_size": 24,
      "flags": {}
    }
  ],
  "config": {},
  "extra": {
    "groupNodes": {},
    "ds": {
      "scale": 0.6303940863129148,
      "offset": [
        -677.0815315847087,
        -123.94841286268084
      ]
    },
    "workspace_info": {
      "id": "zTcrjbiuJpccAPZR1l4eS"
    },
    "frontendVersion": "1.27.7",
    "VHS_latentpreview": false,
    "VHS_latentpreviewrate": 0,
    "VHS_MetadataImage": false,
    "VHS_KeepIntermediate": true,
    "ue_links": []
  },
  "version": 0.4
}